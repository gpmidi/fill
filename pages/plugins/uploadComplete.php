<?php

$nav['uploadComplete'] = array('url' => '/uploadComplete', 'slug' => 'uploadComplete', 'name' => 'Upload Complete', 'loggedInOnly' => 999, 'minRole' => 0, 'weight' => 4, 'extrapre' => '', 'extrapost' => ''); // 1 for only logged in
if ($slug == "uploadComplete")
{
	$pluginUsername = $params[0];
	$u = new XenForo_Model_User();
	$pluginUserID = $u->getUserIdFromUser($u->getUserByName($pluginUsername));
	$pluginName = $params[1];
	$dbQuery = Database::select('plugins', 'pid', array('pname = ? AND pauthor_id = ?', $pluginName, $pluginUserID));
	if ((User::$role == User::ROLE_GUEST || User::$uid != $pluginUserID) && (User::$role != User::ROLE_ADMIN))
	{
		$httpError = 403;
	}
	else if ($dbQuery->rowCount() != 1)
	{
		$httpError = 404;
	}
	else
	{
		$pluginID = $dbQuery->fetchColumn(0);
		// Have they uploaded stuff before?
		$dbQuery2 = Database::select('plugin_downloads', '*', array('pid = ?', $pluginID));
		if ($dbQuery2->rowCount() == 0)
		{
			die('ERROR ERROR ERROR');
		}
		$listNess = $dbQuery2->fetchAll();
		Content::setTitle('Upload complete');
		Content::setContent(<<<EOT
				<p>$randomPrintR</p>
EOT
		);
	}
}
